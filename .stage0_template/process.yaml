$schema: "https://stage0/schemas/process.schema.yaml"
$id: "https://stage0/template-mongodb-api/process.yaml"
title: Process file for a MongoDB configuration API template
version: "1.0"

environment:
  SERVICE_NAME: The service domain name (e.g., mongodb)

context:
  - key: architecture
    type: path
    path: specifications.architecture
  - key: service
    type: selector
    path: architecture.domains
    filter:
      property: name
      value: "{{SERVICE_NAME}}"
  - key: data_catalog
    type: path
    path: specifications.data_catalog
  - key: product_info
    type: path
    path: specifications.product

requires:
  - product_info.product
  - product_info.organization
  - service.data.creates
  - data_catalog.dictionaries

templates:
  # Collections
  - path: "./input/collections/collection.yaml.template"
    mergeFor:
      items: service.data.creates
      output: "./input/collections/{{name}}.yaml"

  # Test Data
  - path: "./input/data/data.json.template"
    mergeFor:
      items: service.data.creates
      output: "./input/data/{{name}}.1.0.0.1.json"

  # Dictionaries
  - path: "./input/dictionary/dictionary.yaml.template"
    mergeFor:
      items: data_catalog.dictionaries
      output: "./input/dictionary/{{name}}.1.0.0.yaml"

  # Infrastructure
  - path: "./docker-compose.yaml"
    merge: true
  - path: "./Dockerfile"
    merge: true
  - path: "./makefile"
    merge: true
  - path: "./README.md"
    merge: true

